{% extends "base.html" %}

{% block title %}GDD RAG - Unified RAG App{% endblock %}

{% block content %}
<div class="gdd-container">
    <!-- Tab Navigation -->
    <div class="tab-navigation">
        <button class="tab-btn active" data-tab="rag">GDD RAG</button>
        <button class="tab-btn" data-tab="explainer">Document Explainer</button>
    </div>
    
    <!-- Tab 1: GDD RAG (existing functionality) -->
    <div id="tab-rag" class="tab-content active">
        <div class="upload-section">
            <h3>Upload Document</h3>
            <input type="file" id="file-upload" accept=".pdf">
            <button id="upload-btn" class="btn-primary">Upload & Index</button>
            <div id="upload-status"></div>
        </div>
        
        <div class="layout">
            <div class="sidebar">
                <h2>Indexed Documents</h2>
                <input type="text" id="document-search" class="document-search" placeholder="Search documents...">
                <p style="font-size:0.8rem;margin:4px 0 8px 0;">
                    Click a document to filter queries to that document.
                </p>
                <div id="documents-list">
                    <p>Loading documents...</p>
                </div>
            </div>
            
            <div class="main-panel">
                <div class="chat-container" id="chat-container">
                    <div class="message bot-message" id="gdd-welcome-message">
                        Welcome! Upload a document or select one from the sidebar to start querying.
                    </div>
                </div>
            </div>
        </div>
        
        <div class="input-area">
            <input type="text" id="query-input" placeholder="Ask a question about the game design documents...">
            <button id="send-btn" class="btn-primary">Send</button>
            <button id="clear-chat-btn" class="btn-secondary">Clear Chat</button>
        </div>
    </div>
    
    <!-- Tab 2: Document Explainer (NEW) -->
    <div id="tab-explainer" class="tab-content" style="display: none;">
        <div class="explainer-layout">
            <!-- Left Column -->
            <div class="explainer-left">
                <!-- Keyword Search Bubble -->
                <div class="explainer-bubble keyword-search-bubble">
                    <h3 class="bubble-title">Keyword Search</h3>
                    <div class="keyword-input-wrapper">
                        <input type="text" id="explainer-keyword" 
                               placeholder="Enter keyword..." 
                               class="keyword-input">
                        <button id="explainer-search-btn" class="search-icon-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- Results Count -->
                <div id="results-count" class="results-count" style="display: none;"></div>
                
                <!-- Document Selection -->
                <div id="explainer-results-container" class="explainer-bubble document-selection-bubble" style="display: none;">
                    <h3 class="bubble-title">Select Documents</h3>
                    <div class="select-all-none">
                        <label class="select-option">
                            <input type="checkbox" id="select-all-checkbox">
                            <span>All</span>
                        </label>
                        <label class="select-option">
                            <input type="checkbox" id="select-none-checkbox">
                            <span>None</span>
                        </label>
                    </div>
                    <div id="explainer-results-checkboxes" class="document-list"></div>
                </div>
                
                <!-- Generate Explanation Button -->
                <button id="explain-btn" class="btn-primary generate-btn" disabled>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                        <path d="M2 17l10 5 10-5"></path>
                        <path d="M2 12l10 5 10-5"></path>
                    </svg>
                    Generate Explanation
                </button>
            </div>
            
            <!-- Right Column -->
            <div class="explainer-right">
                <!-- Explanation Bubble (Large) -->
                <div class="explainer-bubble explanation-bubble">
                    <h3 class="bubble-title">Explanation</h3>
                    <div id="explanation-output" class="bubble-content">
                        <p class="placeholder-text">Search for a keyword and select documents to generate an explanation.</p>
                    </div>
                </div>
                
                <!-- Bottom Row: Source Chunks and Metadata -->
                <div class="explainer-bottom-row">
                    <!-- Source Chunks Bubble (Left) -->
                    <div class="explainer-bubble source-chunks-bubble">
                        <h3 class="bubble-title">Source Chunks</h3>
                        <div id="source-chunks-output" class="bubble-content">
                            <p class="placeholder-text">No source chunks yet.</p>
                        </div>
                    </div>
                    
                    <!-- Metadata Bubble (Right) -->
                    <div class="explainer-bubble metadata-bubble">
                        <h3 class="bubble-title">Metadata</h3>
                        <div id="metadata-output" class="bubble-content">
                            <p class="placeholder-text">No metadata yet.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/gdd.js') }}"></script>
<script src="{{ url_for('static', filename='js/explainer.js') }}"></script>
{% endblock %}

